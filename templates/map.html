{{ define "map-page" }}
<section class="section">
  <div class="container is-fluid">

    <div class="columns">
      <div class="column is-8">
        <div class="card">
          <header class="card-header">
            <p class="card-header-title">{{ .mapTitle }}</p>
          </header>
          <div class="card-content">
            <div id="map" style="height:520px"></div>
          </div>
        </div>
      </div>

      <div class="column is-4">
        <div class="card">
          <header class="card-header">
            <p class="card-header-title">Interpretasi</p>
          </header>
          <div class="card-content content">

            <p>
              Peta ini menampilkan <strong>tingkat pendidikan rata-rata desa</strong>
              di Provinsi Sulawesi Barat.
            </p>

            <p>
              Interpretasi warna:
            </p>

            <ul>
              <li><strong>Warna gelap</strong> → tingkat pendidikan rendah</li>
              <li><strong>Warna cerah</strong> → tingkat pendidikan tinggi</li>
            </ul>

            <p>
              Skala tingkat pendidikan:
            </p>

            <ol>
              <li>Tidak sekolah</li>
              <li>PAUD / TK</li>
              <li>Tamat SD</li>
              <li>Tamat SMP</li>
              <li>Tamat SMA / SMK</li>
              <li>Diploma (D1-D3)</li>
              <li>Sarjana (S1)</li>
              <li>Magister (S2)</li>
              <li>Doktor (S3)</li>
            </ol>

            <!-- OPSIONAL: GAMBAR LEGEN -->
            <!--
            <figure class="image is-4by3">
              <img src="/static/maps/legend_pendidikan.png" alt="Legenda">
            </figure>
            -->

          </div>
        </div>

      </div>

    </div>

  </div>
</section>

<!-- ===================== -->
<!-- LEAFLET JS -->
<!-- ===================== -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- ===================== -->
<!-- BULMA BURGER -->
<!-- ===================== -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const burgers = document.querySelectorAll('.navbar-burger');
    burgers.forEach(burger => {
      burger.addEventListener('click', () => {
        const target = document.getElementById(burger.dataset.target);
        burger.classList.toggle('is-active');
        target.classList.toggle('is-active');
      });
    });
  });
</script>

<!-- ===================== -->
<!-- MAP SCRIPT -->
<!-- ===================== -->
<script>
  const sulbarBounds = L.latLngBounds(
    L.latLng(-3.60, 118.60),
    L.latLng(-1.40, 120.20)
  );

  const map = L.map('map', {
    center: [-2.5, 119.3],
    zoom: 9,
    minZoom: 8,
    maxZoom: 15,
    maxBounds: sulbarBounds,
    maxBoundsViscosity: 1.0
  });

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  function getColor(v) {
    return v >= 9 ? '#ffffcc' :
      v >= 8 ? '#c7e9b4' :
        v >= 7 ? '#7fcdbb' :
          v >= 6 ? '#41b6c4' :
            v >= 5 ? '#1d91c0' :
              v >= 4 ? '#225ea8' :
                v >= 3 ? '#253494' :
                  v >= 2 ? '#2c2c84' :
                    v >= 1 ? '#081d58' :
                      '#ffffff';
  }

  function styleDesa(feature) {
    const v = feature.properties.TINGKAT_PENDIDIKAN || 0;
    return {
      color: '#555',
      weight: 1,
      fillColor: getColor(v),
      fillOpacity: 0.7
    };
  }

  function onEachDesa(feature, layer) {
    if (feature.properties) {
      let popup = `<strong>${feature.properties.NAMOBJ}</strong><br>`;
      popup += `Tingkat Pendidikan: ${feature.properties.TINGKAT_PENDIDIKAN}`;
      layer.bindPopup(popup);
    }

    layer.on({
      mouseover: e => e.target.setStyle({ weight: 2 }),
      mouseout: e => geojson.resetStyle(e.target)
    });
  }

  let geojson;
  fetch('/api/map')
    .then(res => res.json())
    .then(data => {
      geojson = L.geoJSON(data, {
        style: styleDesa,
        onEachFeature: onEachDesa
      }).addTo(map);

      map.fitBounds(geojson.getBounds());
    })
    .catch(err => console.error(err));
</script>

{{ end }}